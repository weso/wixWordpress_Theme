!function(){var a={population:"bin/population.json",primary:"http://intertip.webfoundation.org/api/observations/P4,P7,P9,S11,S12,ITU_N/ALL/2013?callback=?",neutrality:"bin/neutrality.json",equality:"bin/rank_gni_gini.json",flags:"bin/flags_lookup.json",economic_regional:"bin/economic_regional.json",labels:"bin/labels.json"};window.loadVizData=function(b){function c(a,b){$.getJSON(a,function(a){b(null,a)})}var d=queue();for(var e in a)d.defer(c,a[e]);d.await(function(a,c,d,e,f,g,h,i){var j={};_(d.data).each(function(a){"undefined"==typeof j[a.code]&&(j[a.code]={}),j[a.code][a.indicator]=a.value,j[a.code].name=a.name});var k={};_(j).each(function(a,b){k[b]={},k[b].ITU=j[b].ITU_N}),_(c).each(function(a,b){c[b]&&k[b]&&(k[b].Population=c[b])}),_(e).each(function(a,b){j[b]&&e[b]&&(e[b].Score=j[b].P7)}),b({itu:k,primary:j,neutrality:e,equality:f,flags:g,economic_regional:h,labels:i})})}}(),function(){function a(a,b,c){var d;return function(){var e=this,f=arguments;clearTimeout(d),d=setTimeout(function(){d=null,c||a.apply(e,f)},b),c&&!d&&a.apply(e,f)}}function b(a,b,c){for(var d=0,e=a.length;e>d;++d)if(a[d][b]===c)return d;return-1}function c(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function d(a){return a>1e9?Math.round(a/1e8)/10+" billion":a>1e6?Math.round(a/1e5)/10+" million":c(Math.round(a))}window.Utility=window.Utility||{},window.Utility.debounce=a,window.Utility.firstIndex=b,window.Utility.comma=c,window.Utility.prettyN=d;var e=$(window),f=function(){this.dispatches={};var b=this.dispatch.bind(this);e.on("resize",a(b,500,!1))};f.prototype.dispatch=function(){_.each(this.dispatches,function(a){a.fn.apply(a.context)})},f.prototype.addDispatch=function(a,b,c){this.dispatches[a]={fn:b,context:c}},f.prototype.delDispatch=function(a){delete this.dispatches[a]},window.Utility.resize=new f}(),$(document).on("ready",function(){var a=[{id:"censorship-and-surveillance",fn:"CensorshipViz"},{id:"gender",fn:"GenderViz"},{id:"surveillance",fn:"SurveillanceViz"},{id:"neutrality-viz",fn:"NeutralityViz"},{id:"equality-viz",fn:"EqualityViz"}];loadVizData(function(b){for(var c=0;c<a.length;++c){var d=a[c],e=$("#"+d.id);e.length&&(d.$el=e,window[d.fn](b,d))}})}),function(){"use strict";var a=function(a){var b=a.primary,c=a.itu,d=0,e={};for(var f in b){var g=c[f].Population*c[f].ITU/100;d+=g,e[f]={pop:c[f].Population,itu:g,name:b[f].name,censorship:10-b[f].P4,surveillance:10-b[f].P9}}return this.itu=$("#sv-affected-itu"),this.countries=$("#sv-affected-countries"),this.data=e,this.metrics={},this.metricName="",this.$tooltip=$("#sv-overlay-tip"),this};a.prototype.draw=function(){function a(a){if(!a.country)return["<h3>",j.data[a.id].name,"</h3><hr /><h4>"+j.labels.sv_tooltip_legend_na+" </h4>"].join("");var b=a.stat?j.labels.sv_tooltip_legend_true:j.labels.sv_tooltip_legend_false;return["<h3>",j.data[a.id].name,"</h3><h4>",Utility.prettyN(a.country.itu),' internet users</h4><h4 class="sv-affected-',a.stat,'">',b,"</h4><hr /><table><tbody><tr><td>",a.country.censorship,"</td><td>"+j.labels.sv_tooltip_degree_censorship+"</td></tr><tr><td>",a.country.surveillance,"</td><td>"+j.labels.sv_tooltip_degree_surveillance+"</td></tr><tr><td>","</tbody</table>"].join("")}var b=this.$el.width(),c=this.$el.height(),d=this.svg=d3.select("#"+this.id).append("svg:svg").attr("class","sv-mapbox").attr("width",b).attr("height",c),e=this.projection=d3.geo.mercator().scale((b+1)/2/Math.PI).translate([b/2,c/1.41]).precision(.1),f=this.path=d3.geo.path().projection(e),g=this.$tooltip,h=this.allCountries=d.append("g").attr("class","sv-boundary-layer").style("stroke-linejoin","round").selectAll("path").data(this.topo).enter().append("path").attr("class","sv-boundary").attr("d",f).on("mouseover",function(b){g.html(a(b)).show()}).on("mouseout",function(){g.hide()}),i=this.data;this.dataCountries=h.filter(function(a){return a.country=i[a.id],a.country}),this.fill(),$(".sv-affected-labels").fadeIn(400);var j=this},a.prototype.onDrag=function(a,b){this.metrics[b]=a,this.fill()},a.prototype.fill=function(){var a=this.metricName,b=this.metrics[a],c=0,d=0;this.dataCountries.transition().duration(200).style("fill",function(e){return e.country[a]<b?(e.stat=!1,"#909090"):(e.stat=!0,c+=e.country.itu,d+=1,"#222")}),this.itu.text(Utility.prettyN(c)),this.countries.text(d)},a.prototype.resize=function(){var a=this.$el.width(),b=this.$el.height();this.svg.attr("width",a).attr("height",b),this.projection.scale((a+1)/2/Math.PI).translate([a/2,b/1.41]),this.path.projection(this.projection),this.allCountries.attr("d",this.path)};var b=function(a){var b=$("#"+a.id),c=b.find(".slider"),d=b.find(".disable-toggle"),e=!0;c.noUiSlider({start:[a.start],step:1,range:a.range}),c.on("slide",function(){var b=Math.round(c.val());a.dragFn(b,a.name)}),d.click(function(){e?(c.attr("disabled","disabled"),b.addClass("sv-disabled"),a.stopFn(a.name)):(c.removeAttr("disabled"),b.removeClass("sv-disabled"),a.dragFn(Math.round(c.val()),a.name)),e=!e})},c=function(c,d){var e=c.labels,f=new a(c);f.id=d.id,f.$el=d.$el,f.labels=e;var g=(f.resize.bind(f),f.onDrag.bind(f));Utility.resize.addDispatch("censorship",f.resize,f);var h={censorship:{id:"censorship-slider",start:2,name:"censorship",key:"P4"},surveillance:{id:"surveillance-slider",start:4,name:"surveillance",key:"P9"}};_.each(h,function(a){var d=d3.extent(_.values(c.primary),function(b){return b[a.key]});a.UI=new b({id:a.id,start:a.start,name:a.name,range:{min:10-d[1]+1,max:10-d[0]},dragFn:Utility.debounce(g,400,!1),stopFn:function(){}}),a.$el=$("#"+a.id),$("#"+a.id+"> h3").html(e["sv_degree_"+a.name]),f.metrics[a.name]=a.start}),f.metricName="censorship";var i=$("#sv-type-toggle");i.length&&i.on("click","button",function(){var a=$(this);if(a.hasClass("selected"))return!1;i.find(".selected").removeClass("selected"),a.addClass("selected");var b=h[a.attr("data-type")];f.metricName=b.name,_.each(h,function(a){a.name===b.name?a.$el.fadeIn(200):a.$el.hide()}),f.fill()});var j={"sv-legend-true":"sv_legend_true","sv-legend-false":"sv_legend_false","sv-legend-na":"sv_legend_na","sv-censorship-slider-low":"sv_censorship_slider_low","sv-censorship-slider-high":"sv_censorship_slider_high","sv-surveillance-slider-low":"sv_surveillance_slider_low","sv-surveillance-slider-high":"sv_surveillance_slider_high","sv-main-tally-number":"sv_main_tally_number","sv-main-country-number":"sv_main_country_number"};_(j).each(function(a,b){e[a]&&$("#"+b).html(e[a])}),d3.json("bin/country_boundaries.topojson",function(a){f.topo=topojson.feature(a,a.objects.countries).features,f.draw()})};window.CensorshipViz=c}(),function(){"use strict";function a(a,c){var d=a.labels,e=new b(a,c);e.$el=c.$el;var f=$("#eq-ui-container");f.length&&f.on("click","button",function(){var a=$(this);return a.hasClass("selected")?!1:(f.find(".selected").removeClass("selected"),a.addClass("selected"),void(e.attribute=a.attr("data-type")))}),e.attribute="region";var g={"eq-main-action":"gn_nn_main_action","eq-toggle-region":"gn_nn_toggle_region","eq-toggle-econ":"gn_nn_toggle_econ"};_(g).each(function(a,b){console.log(b),d[a]&&$("#"+b).html(d[a])}),Utility.resize.addDispatch("equality",e.resize,e)}var b=function(a,b){function c(a){p.html(q({country:a.name,score_label:s.eq_score_label,score:a.overall.toFixed(2),income_label:s.eq_gni_label,income:"$"+Utility.comma(a.income),inequality_label:s.eq_inequality_label,inequality:a.inequality})).show()}this.labels=a.labels;var d=(_(a.economic_regional).map(function(a,b){return{key:b,region:a.region,econ:parseInt(a.econ)}}),_.map(a.equality,function(b,c){return{code:c,name:a.primary[c].name,region:a.economic_regional[c].region,econ:a.economic_regional[c].econ,income:b.gni,inequality:b.gini,rank:b.rank,overall:b.score}}));d=this.data=_.chain(d).filter(function(a){return a.inequality}).sortBy(function(a){return-a.inequality}).value();var e=this.margin=[50,25,50,25],f=(this.topLabelHeight=40,b.$el.height()-e[0]-e[2]),g=b.$el.width()-e[1]-e[3],h=this.x=d3.scale.linear().domain(d3.extent(d,function(a){return a.rank})).range([g,0]),i=this.y=d3.scale.linear().domain(d3.extent(d,function(a){return a.income})).range([f,0]),j=d3.scale.sqrt().domain(d3.extent(d,function(a){return a.inequality})).range([7,40]),k=this.svg=d3.select("#"+b.id).append("svg").attr("class","eq-svg").attr("width",g+e[1]+e[3]).attr("height",f+e[0]+e[2]),l=this.g=k.append("g").attr("transform","translate("+e[3]+","+e[0]+")"),m=[{dy:"-2em",dx:"-50px",text:this.labels.eq_low_index_score,anchor:"end"},{dy:"-2em",dx:"50px",text:this.labels.eq_high_index_score,anchor:"start"}];this.xTicks=l.append("g").selectAll(".xtick").data(m).enter().append("text").attr("class","xtick").text(function(a){return a.text}).attr("transform",function(){return"translate("+[g/2,0]+")"}).attr("dy",function(a){return a.dy}).attr("dx",function(a){return a.dx}).attr("text-anchor",function(a){return a.anchor});var n=[{pos:2e4,label:this.labels.eq_20k},{pos:4e4,label:this.labels.eq_40k},{pos:8e4,label:this.labels.eq_80k}];this.yTicks=l.append("g").selectAll(".ytick").data(n).enter().append("g").attr("class","ytick").attr("transform",function(a){return"translate(0,"+i(a.pos)+")"}),this.yTicks.append("line").attr("x1",0).attr("x2",g).attr("y1",0).attr("y2",0).attr("class","eq-divider").attr("stroke-dasharray","5,5"),this.yTicks.append("text").text(function(a){return a.label}).attr("text-anchor","middle").attr("dx",g/2+"px").attr("dy","-4px");var o,p=this.$tooltip=$("#eq-overlay-tip"),q=_.template($("#eq-tooltip").html()),r=this.countries=l.selectAll(".eq-country").data(d).enter().append("g").attr("class","eq-country"),s=this.labels,t=!1,u=this.circles=r.append("circle").attr("r",0).attr("cx",function(a){return h(a.rank)}).attr("cy",function(a){return i(a.income)});u.on("mouseover",function(a){t||(o=d3.select(this),o.transition().duration(200).style("stroke-width",".5em"),c(a))}).on("mouseout",function(){t||(o.transition().duration(200).style("stroke-width",".1em"),p.hide())}).on("click",function(a){t=!0,o=d3.select(this),o.transition().duration(200).style("stroke-width",".5em"),c(a)}),u.transition().duration(200).delay(function(a,b){return 5*b}).attr("r",function(a){return j(a.inequality)})};b.prototype.resize=function(){var a=this.margin,b=this.$el.height()-a[0]-a[2],c=this.$el.width()-a[1]-a[3];this.svg.attr("width",c+a[1]+a[3]).attr("height",b+a[0]+a[2]);var d=this.x,e=this.y;d.range([c,0]),e.range([b,0]),this.xTicks.transition().attr("transform",function(){return"translate("+[c/2,0]+")"}),this.yTicks.select("line").attr("x2",c),this.yTicks.select("text").attr("dx",c/2+"px"),this.yTicks.transition().attr("transform",function(a){return"translate(0,"+e(a.pos)+")"}),this.circles.transition().attr("cx",function(a){return d(a.rank)}).attr("cy",function(a){return e(a.income)})},window.EqualityViz=a}(),function(){function a(a,c){var e=a.labels,f=a.economic_regional,g=_.map(a.primary,function(a,c){var d=a.S11,g=a.S12;return{support:d,action:g,overall:(d+g)/2,scores:{support:b(d,e),action:b(g,e),overall:b((d+g)/2,e)},diff:d-g,name:a.name,econ:f[c]?f[c].econ:"NA",region:f[c]?f[c].region:"NA"}}),h=new d;h.labels=a.labels,h.$tooltip=$("#gn-overlay-tip"),h.draw(g,c);var i=$("#gn-ui-container");i.length&&i.on("click","button",function(){var a=$(this);return a.hasClass("selected")?!1:(i.find(".selected").removeClass("selected"),a.addClass("selected"),void(h.attribute=a.attr("data-type")))});var j={"gn-main-action":"gn_nn_main_action","gn-toggle-region":"gn_nn_toggle_region","gn-toggle-econ":"gn_nn_toggle_econ"};_(j).each(function(a,b){e[a]&&$("#"+b).html(e[a])}),Utility.resize.addDispatch("gender",h.resize,h)}function b(a,b){return 3>=a?b.gn_tooltip_low:7>=a?b.gn_tooltip_medium:b.gn_tooltip_high}function c(a){var b=this.fontSize=d3.scale.quantize().domain([0,a]);return b.range(450>=a?[15,14,13.5,13,13.5,12,11.5,11,10.5,10,9,8,7,6,5,4]:[23,19,17,15,14,13.5,13,13.5,12,11.5,11,10.5,10,9,8,7]),b}var d=function(){return this};d.prototype.draw=function(a,b){function d(a){z.each(function(b){b.match=b[x.attribute]===a}).style("opacity",function(a){return a.match?1:.2}).style("fill",function(a){return a.match?"#993333":"#999"})}function e(a){var b=x.labels;return["<label>",a.name,"</label><hr /><table><tbody><tr><td>",b["region_translation_"+a.region],"</td><td>"+b.gn_tooltip_supports+": ",a.support,'<span class="gn-score-',a.scores.support,'"> (',a.scores.support,")</span></td></tr><tr><td>",b["econ_translation_"+a.econ],"</td><td>"+b.gn_tooltip_prosecutes+": ",a.action,'<span class="gn-score-',a.scores.action,'"> (',a.scores.action,")</span></td></tr></tbody</table>"].join("")}this.$el=b.$el;var f=this.margin=[50,0,40,0],g=this.topLabelHeight=40,h=b.$el.height()-f[0]-f[2],i=b.$el.width()-f[1]-f[3],j=d3.max(a,function(a){return Math.abs(a.diff)})+1,k=this.x=d3.scale.linear().domain([-j,j]).range([0,i]),l=this.y=d3.fisheye.scale(d3.scale.linear).distortion(5).domain([0,a.length]).range([0,h]),m=(this.fontSize=c(h),this.fill=d3.scale.quantize().domain([0,h]).range(["#141414","#292929","#3d3d3d","#525252","#666666","#a1a1a1","#bfbfbf","#dcdcdc"]),this.position.bind(this)),n=this.svg=d3.select("#"+b.id).append("svg").attr("class","gn-viz").attr("width",i+f[1]+f[3]).attr("height",h+f[0]+f[2]).on("mousemove",function(){m(d3.mouse(this))}).attr("stroke-dasharray","5,5");n.append("line").attr("class","gn-viz-divide").attr("x1",i/2).attr("x2",i/2).attr("y1",g).attr("y2",h+f[2]+f[0]-g);var o=[{text:[this.labels.gn_xaxis_supports_1,this.labels.gn_xaxis_supports_2],x:j/2},{text:[this.labels.gn_xaxis_equal_1,this.labels.gn_xaxis_equal_2],x:0},{text:[this.labels.gn_xaxis_prosecutes_1,this.labels.gn_xaxis_prosecutes_2],x:-j/2}];this.xLabels=n.selectAll(".gn-viz-label").data(o).enter().append("text").attr("class","gn-viz-label").attr("transform",function(a){return"translate("+k(a.x)+",0)"}).attr("dy",-4),this.xLabels.selectAll("tspan").data(function(a){return a.text}).enter().append("tspan").text(function(a){return a}).attr("x",0).attr("dy","1.2em");var p=n.append("g").attr("transform","translate("+f[3]+","+f[0]+")"),q=_.sortBy(a,function(a){return-a.overall}),r=(q.length-1)/2,s=115,t=[{text:this.labels.gn_yaxis_best,y:0},{text:this.labels.gn_yaxis_median,y:r},{text:this.labels.gn_yaxis_worst,y:q.length-1}],u=this.yLabelPaths=p.selectAll(".y-label").data(t).enter().append("g").attr("class","gn-y-label").attr("transform",function(a){return"translate(0,"+l(a.y)+")"});u.append("text").text(function(a){return a.text}).attr("x",s).attr("dx","-5px").attr("dy","4px"),u.append("line").attr("x1",s).attr("x2",i).attr("y1",0).attr("y2",0);var v,w=!1,x=this;this.attribute="region";var y=this.$tooltip,z=this.countries=p.append("g").attr("class","gn-countries").selectAll("text").data(q).enter().append("text").attr("text-anchor","middle").attr("x",function(a){return k(a.diff)}).text(function(a){return a.name}).on("mouseover",function(a){y.html(e(a)).show(),w=!1,v=window.setTimeout(function(){w=!0,d(a[x.attribute])},1e3)}).on("mouseout",function(){y.hide(),window.clearTimeout(v),w&&z.style("opacity",1)}),A=[.5*i,.05*h];m(A);var x=this},d.prototype.position=function(a){a[1]-=this.margin[0],this.y.focus(a[1]);var b=this.y,c=this.fontSize,d=this.fill;this.countries.attr("y",function(a,c){return a.y=b(c),a.y}).style("font-size",function(b){return b.distance=Math.abs(b.y-a[1]),c(b.distance)+"px"}).style("fill",function(a){return d(a.distance)}),this.yLabelPaths.attr("transform",function(a){return"translate(0,"+b(a.y)+")"}),this.pos=a},d.prototype.resize=function(){var a=this.margin,b=this.$el.height()-a[0]-a[2],c=this.$el.width()-a[1]-a[3];this.svg.attr("width",c+a[1]+a[3]).attr("height",b+a[0]+a[2]).select(".gn-viz-divide").attr("x1",c/2).attr("x2",c/2).attr("y2",b+a[2]+a[0]-this.topLabelHeight),this.x.range([0,c]),this.y.range([0,b]);{var d=this.x;this.y}this.xLabels.transition().duration(400).attr("transform",function(a){return"translate("+d(a.x)+",0)"}),this.fill.domain([0,b]),this.fontSize.domain([0,b]),this.position([.5*c,.05*b]),this.countries.transition().duration(400).attr("x",function(a){return d(a.diff)})},window.GenderViz=a}(),function(){"use strict";function a(a,b){var d=a.labels,e=new c(a,b);e.$el=b.$el;var f=$("#nn-ui-container");f.length&&f.on("click","button",function(){var a=$(this);return a.hasClass("selected")?!1:(f.find(".selected").removeClass("selected"),a.addClass("selected"),void(e.attribute=a.attr("data-type")))}),e.attribute="region";var g={"nn-main-action":"gn_nn_main_action","nn-toggle-region":"gn_nn_toggle_region","nn-toggle-econ":"gn_nn_toggle_econ"};_(g).each(function(a,b){d[a]&&$("#"+b).html(d[a])}),Utility.resize.addDispatch("neutrality",e.resize,e),e.draw()}function b(a,b,c){this.maxColumn=b||1/0,this.maxRow=a||1/0,this.qu=[[0,0]],this.positions={0:{x:0,y:0}},this.matrix={0:{0:1}},this.cursor=0,this.numItems=1,this.fill=function(){for(;this.qu.length>0&&this.numItems<c;){var d=this.qu.shift(),e=d[0],f=d[1];this.matrix[e]&&this.matrix[e][f]||(this.positions[this.numItems]={x:e,y:f},this.matrix[e]||(this.matrix[e]={}),this.matrix[e][f]=1,this.numItems+=1),a>e+1&&this.qu.push([e+1,f]),b>f+1&&this.qu.push([e,f+1])}},this.getPosition=function(a){return this.positions[a]}}var c=function(a,b){function c(a){return a?a.length:0}this.dataset=[],this.labels=a.labels;var d=_(a.economic_regional).map(function(a,b){return{key:b,region:a.region,econ:parseInt(a.econ)}});_(a.neutrality).each(function(b,c){this.dataset.push({key:c,name:a.primary[c].name,discriminates:"Yes"===b["Discriminates Traffic"].trim()?1:-1,has_law:"Yes"===b["Has Law"].trim()?1:-1,score:b.Score,id:a.flags[c].ID,region:a.economic_regional[c].region,econ:a.economic_regional[c].econ})}.bind(this)),this.svg=d3.select("#"+b.id).append("svg").attr("class","nn-svg"),this.svg.selectAll("rect").data(this.dataset).enter().append("rect").attr("class","nn-rect").attr("data-name",function(a){return a.key});var e=this.svg.append("text").attr("class","nn-text-ne nn-text");e.append("tspan").text("●").attr("class","nn-pos-dot"),e.append("tspan").attr("x",10).attr("dy",0).attr("dx",-20).text(this.labels.nn_axis_no_discrimination),e.append("tspan").text("●").attr("dy","20").attr("class","nn-pos-dot"),e.append("tspan").attr("x",0).attr("dy","20").attr("dx",-20).text(this.labels.nn_axis_law);var f=this.svg.append("text").attr("class","nn-text-nw nn-text");f.append("tspan").text("●").attr("class","nn-neg-dot"),f.append("tspan").attr("x",0).attr("dy",0).attr("dx",20).text(this.labels.nn_axis_discrimination),f.append("tspan").text("●").attr("dy","20").attr("class","nn-pos-dot"),f.append("tspan").attr("x",0).attr("dy","20").attr("dx",20).text(this.labels.nn_axis_law);var g=this.svg.append("text").attr("class","nn-text-sw nn-text");g.append("tspan").text("●").attr("class","nn-neg-dot"),g.append("tspan").attr("x",0).attr("dy",0).attr("dx",20).text(this.labels.nn_axis_discrimination),g.append("tspan").text("●").attr("dy","20").attr("class","nn-neg-dot"),g.append("tspan").attr("x",0).attr("dy",20).attr("dx",20).text(this.labels.nn_axis_no_law);var h=this.svg.append("text").attr("class","nn-text-se nn-text");h.append("tspan").text("●").attr("class","nn-pos-dot"),h.append("tspan").attr("x",0).attr("dy",0).attr("dx",-20).text(this.labels.nn_axis_no_discrimination),h.append("tspan").text("●").attr("dy","20").attr("class","nn-neg-dot"),h.append("tspan").attr("x",0).attr("dy",20).attr("dx",-20).text(this.labels.nn_axis_no_law),this.svg.append("line").attr("class","nn-xLine-nw"),this.svg.append("line").attr("class","nn-yLine-nw"),this.svg.append("line").attr("class","nn-xLine-ne"),this.svg.append("line").attr("class","nn-yLine-ne"),this.svg.append("line").attr("class","nn-xLine-sw"),this.svg.append("line").attr("class","nn-yLine-sw"),this.svg.append("line").attr("class","nn-xLine-se"),this.svg.append("line").attr("class","nn-yLine-se"),this.groupBy={};var i=_(this.dataset).groupBy(function(a){return a.has_law});this.groupBy[-1]=_(i[-1]).chain().sortBy(function(a){return a.score}).groupBy(function(a){return a.discriminates}).value(),this.groupBy[1]=_(i[1]).chain().sortBy(function(a){return a.score}).groupBy(function(a){return a.discriminates}).value(),this.groupByRegion=_(d).groupBy(function(a){return a.region}),this.groupByEcon=_(d).groupBy(function(a){return a.econ}),this.maxSetSize=Math.max(c(this.groupBy[1][-1]),c(this.groupBy[-1][-1]),c(this.groupBy[1][1]),c(this.groupBy[-1][1]));var j="bin/square-flags/",k=".png";this.svg.append("defs");var l=this.svg.select("defs");_(a.flags).each(function(a){l.append("pattern").attr("id","image_"+a.ID).attr({x:0,y:0,width:1,height:1,patternContentUnits:"objectBoundingBox"}).append("image").attr({x:0,y:0,width:1,height:1}).attr("xlink:href",j+a.Flag_Name+k)})};c.prototype.resize=function(){this.draw()},c.prototype.draw=function(){this.$el.width()>this.$el.height()?(this.width=this.$el.width(),this.height=this.$el.height()):(this.width=this.$el.width(),this.height=.8*this.$el.width()),this.svg.attr("width",this.width).attr("height",this.height);var a=Math.floor(Math.sqrt(this.maxSetSize))*(this.width+this.height)/this.width;this.rectSize=Math.floor(Math.min(this.width/2/a,this.height/2/a)),this.margin=this.rectSize,this.centerX=this.width/2,this.centerY=this.height/3+this.margin/3,this.svg.select("#nn-tooltip-text").style("opacity",0),this.box={top:-this.centerY+this.margin/2,bottom:this.height-this.margin,right:this.centerX+this.width/2-this.margin,left:this.centerX-this.width/2+this.margin};var c=8,d=12;this.quad=new b(d,c,this.maxSetSize),this.quad.fill();var e=this;this.svg.selectAll(".nn-text-nw tspan").attr({x:0+this.margin,y:0+this.margin,"text-anchor":"start"}),this.svg.selectAll(".nn-text-ne tspan").attr({x:this.width-this.margin,y:0+this.margin,"text-anchor":"end"}),this.svg.selectAll(".nn-text-sw tspan").attr({x:0+this.margin,y:this.height-2*this.margin,"text-anchor":"start"}),this.svg.selectAll(".nn-text-se tspan").attr({x:this.width-this.margin,y:this.height-2*this.margin,"text-anchor":"end"}),this.rightScale=d3.scale.ordinal().domain(d3.range(0,12)).rangePoints([this.centerX+this.margin/2,this.box.right]).range(),this.leftScale=d3.scale.ordinal().domain(d3.range(0,12)).rangePoints([this.centerX-this.margin/2-this.rectSize,this.box.left]).range(),this.bottomScale=d3.scale.ordinal().domain(d3.range(0,12)).rangePoints([this.centerY+this.margin/2,this.box.bottom]).range(),this.topScale=d3.scale.ordinal().domain(d3.range(0,12)).rangePoints([this.centerY-this.rectSize/2-this.margin,this.box.top]).range(),this.colors=d3.scale.linear().domain(d3.range(0,9)).range(colorbrewer.RdBu[10]);var f=this.margin/6;this.svg.select(".nn-xLine-nw").attr({x1:this.centerX-f,x2:0,y1:this.centerY-f,y2:this.centerY-f,"stroke-width":2,stroke:"black"}),this.svg.select(".nn-yLine-nw").attr({x1:this.centerX-f,x2:this.centerX-f,y1:this.centerY-f,y2:0,"stroke-width":2,stroke:"black"}),this.svg.select(".nn-xLine-ne").attr({x1:this.centerX+f,x2:this.width,y1:this.centerY-f,y2:this.centerY-f,"stroke-width":2,stroke:"black"}),this.svg.select(".nn-yLine-ne").attr({x1:this.centerX+f,x2:this.centerX+f,y1:this.centerY-f,y2:0,"stroke-width":2,stroke:"black"}),this.svg.select(".nn-xLine-sw").attr({x1:this.centerX-f,x2:0,y1:this.centerY+f,y2:this.centerY+f,"stroke-width":2,stroke:"black"}),this.svg.select(".nn-yLine-sw").attr({x1:this.centerX-f,x2:this.centerX-f,y1:this.centerY+f,y2:this.height,"stroke-width":2,stroke:"black"}),this.svg.select(".nn-xLine-se").attr({x1:this.centerX+f,x2:this.width,y1:this.centerY+f,y2:this.centerY+f,"stroke-width":2,stroke:"black"}),this.svg.select(".nn-yLine-se").attr({x1:this.centerX+f,x2:this.centerX+f,y1:this.centerY+f,y2:this.height,"stroke-width":2,stroke:"black"}),this.svg.selectAll("line").attr("stroke","#b1b1b1");var g=this.groupBy;this.svg.selectAll(".nn-rect").attr("y",function(a){var b=e.quad.getPosition(_(g[a.has_law][a.discriminates]).chain().pluck("key").map(function(a){return a}).indexOf(a.key).value());if(b){var c=a.has_law>0?e.topScale[b.y]:e.bottomScale[b.y];return c}}).attr("x",function(a){var b=e.quad.getPosition(_(g[a.has_law][a.discriminates]).chain().pluck("key").map(function(a){return a}).indexOf(a.key).value());if(b){var c=a.discriminates>0?e.leftScale[b.x]:e.rightScale[b.x];return c}}).attr({rx:3,ry:3,width:e.rectSize,height:e.rectSize,fill:function(a){return"url(#image_"+a.id+")"}}).style("stroke",function(a){return e.colors(a.score)});var h=$("#nn-overlay-tip");this.svg.selectAll(".nn-rect").on("mouseover",function(a){var b=_.template($("#nn-tooltip").html()),c="",d="";a.has_law>0?a.discriminates>0?(c="Evidence of discrimination",d="Has effective net neutrality law and regulations"):(c="No Evidence of discrimination",d="Has effective net neutrality law and regulations"):a.discriminates>0?(c="Evidence of discrimination",d="No effective net neutrality law and regulations"):(c="No Evidence of discrimination",d="No effective net neutrality law and regulations"),h.html(b({country:a.name,score:a.score,discriminationText:c,lawText:d,label:e.labels.nn_tooltip_score,region:e.labels["region_translation_"+a.region],econ:e.labels["econ_translation_"+a.econ]})).show(),e.svg.selectAll(".nn-rect").attr("class","nn-rect nn-rect-hover"),d3.select(this).attr("class","nn-rect nn-rect-not-hover"),"region"===e.attribute?_(e.groupByRegion[a.region]).pluck("key").forEach(function(a){d3.select('[data-name="'+a+'"]').attr("class","nn-rect nn-rect-not-hover")}):_(e.groupByEcon[a.econ]).pluck("key").forEach(function(a){d3.select('[data-name="'+a+'"]').attr("class","nn-rect nn-rect-not-hover")})}).on("mouseout",function(){h.hide(),e.svg.selectAll(".nn-rect").attr("class","nn-rect nn-rect-not-hover"),e.svg.selectAll(".nn-text").transition().duration(300).style("opacity",1)})},window.NeutralityViz=a}();