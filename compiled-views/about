<?php return function ($in, $debugopt = 1) {
    $cx = Array(
        'flags' => Array(
            'jstrue' => false,
            'jsobj' => false,
            'spvar' => false,
            'prop' => false,
            'method' => false,
            'mustlok' => false,
            'mustsec' => false,
            'debug' => $debugopt,
        ),
        'helpers' => Array(),
        'blockhelpers' => Array(),
        'hbhelpers' => Array(),
        'partials' => Array(),
        'scopes' => Array($in),
        'sp_vars' => Array(),
'funcs' => Array(
    'sec' => function ($cx, $v, $in, $each, $cb, $inv = null) {
        $isary = is_array($v);
        $loop = $each;
        $keys = null;
        $last = null;
        $is_obj = false;

        if ($isary && $inv !== null && count($v) === 0) {
            return $inv($cx, $in);
        }
        if (!$loop && $isary) {
            $keys = array_keys($v);
            $loop = (count(array_diff_key($v, array_keys($keys))) == 0);
            $is_obj = !$loop;
        }
        if ($loop && $isary) {
            if ($each) {
                if ($keys == null) {
                    $keys = array_keys($v);
                    $is_obj = (count(array_diff_key($v, array_keys($keys))) > 0);
                }
            }
            $ret = Array();
            $cx['scopes'][] = $in;
            $i = 0;
            if ($cx['flags']['spvar']) {
                $last = count($keys) - 1;
            }
            foreach ($v as $index => $raw) {
                if ($cx['flags']['spvar']) {
                    $cx['sp_vars']['first'] = ($i === 0);
                    if ($is_obj) {
                        $cx['sp_vars']['key'] = $index;
                        $cx['sp_vars']['index'] = $i;
                    } else {
                        $cx['sp_vars']['last'] = ($i == $last);
                        $cx['sp_vars']['index'] = $index;
                    }
                $i++;
                }
                $ret[] = $cb($cx, $raw);
            }
            if ($cx['flags']['spvar']) {
                if ($is_obj) {
                    unset($cx['sp_vars']['key']);
                } else {
                    unset($cx['sp_vars']['last']);
                }
                unset($cx['sp_vars']['index']);
                unset($cx['sp_vars']['first']);
            }
            array_pop($cx['scopes']);
            return join('', $ret);
        }
        if ($each) {
            if ($inv !== null) {
                $cx['scopes'][] = $in;
                $ret = $inv($cx, $v);
                array_pop($cx['scopes']);
                return $ret;
            }
            return '';
        }
        if ($isary) {
            if ($cx['flags']['mustsec']) {
                $cx['scopes'][] = $v;
            }
            $ret = $cb($cx, $v);
            if ($cx['flags']['mustsec']) {
                array_pop($cx['scopes']);
            }
            return $ret;
        }

        if ($v === true) {
            return $cb($cx, $in);
        } 

        if (!is_null($v) && ($v !== false)) {
            return $cb($cx, $v);
        }

        if ($inv !== null) {
            return $inv($cx, $in);
        }

        return '';
    },
)

    );
    return ''.'<h1>Esto es un partial</h1>
'.'
<h1>About</h1>
'.'<h2>Gallery</h2>
<ul>
  '.$cx['funcs']['sec']($cx, ((isset($in['data']) && is_array($in)) ? $in['data'] : null), $in, false, function($cx, $in) {return ' '.$cx['funcs']['sec']($cx, ((isset($in['gallery']) && is_array($in)) ? $in['gallery'] : null), $in, true, function($cx, $in) {return '
    <li> '.htmlentities((string)((isset($in['path']) && is_array($in)) ? $in['path'] : null), ENT_QUOTES, 'UTF-8').' </li>
  ';}).' ';}).'
</ul>
'.'
<p>Welcome '.$cx['funcs']['sec']($cx, ((isset($in['labels']) && is_array($in)) ? $in['labels'] : null), $in, false, function($cx, $in) {return ' '.htmlentities((string)((isset($in['name']) && is_array($in)) ? $in['name'] : null), ENT_QUOTES, 'UTF-8').' ';}).', you win $'.$cx['funcs']['sec']($cx, ((isset($in['labels']) && is_array($in)) ? $in['labels'] : null), $in, false, function($cx, $in) {return ' '.htmlentities((string)((isset($in['value']) && is_array($in)) ? $in['value'] : null), ENT_QUOTES, 'UTF-8').' ';}).' dollars!!</p>
'.'<h2>Feedback</h2>
    <form action="" autocomplete="on" class="feedback">
    	<label for="name">Name (required)</label>
        <input type="text" name="name" required />
        <label for="email">Email address (required)</label>
        <input type="email" name="email" required />
        <label for="type">Comment type (required)</label>
        <select name="type" required>
       	      <option value="Indicators and Data">Indicators and Data</option>
              <option value="Methodology">Methodology</option>
              <option value="Countries covered">Countries covered</option>
              <option value="Visualisation and Presentation of the Index">Visualisation and Presentation of the Index</option>
              <option value="Other/General comment">Other/General comment</option>
              <option value="New">New</option>
        </select>
        <label for="comment">Comment (required)</label>
        <textarea name="comment" cols="40" rows="10" required></textarea>
        <input type="submit" value="Send" />
    </form>
'.'
'.'<h2>Tweets timeline</h2>
<ul>
'.$cx['funcs']['sec']($cx, ((isset($in['data']) && is_array($in)) ? $in['data'] : null), $in, false, function($cx, $in) {return '
  '.$cx['funcs']['sec']($cx, ((isset($in['tweets']) && is_array($in)) ? $in['tweets'] : null), $in, false, function($cx, $in) {return '
	  <li>'.htmlentities((string)((isset($in['text']) && is_array($in)) ? $in['text'] : null), ENT_QUOTES, 'UTF-8').'</li>
  ';}).'
';}).'
</ul>'.'
';
}
?>